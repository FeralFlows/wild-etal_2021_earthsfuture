# The Implications of Global Change for the Co-Evolution of Argentina’s Integrated Energy-Water-Land Systems
<!--your zenodo badge here-->

<br />

<!-------------------------->
<!-------------------------->
## Contents
<!-------------------------->
<!-------------------------->
- [Abstract](#abstract)
- [Plain Language Summary](#plain)
- [Code Reference](#code-reference)
- [Journal Reference](#journal-reference)
- [Contributing Models](#contributing-models)
- [Data Reference](#data-reference)
- [Reproduce My Experiment](#reproduce-my-experiment)

<br />

<!-------------------------->
<!-------------------------->
## Abstract
<!-------------------------->
<!-------------------------->

This study seeks to understand how Argentina’s energy, water, and land (EWL) systems will co-evolve under a representative array of human and earth system influences, including socioeconomic change, climate change, and climate policy. To capture Argentina’s sub-national EWL dynamics in the context of global change, we couple the Global Change Analysis Model with a suite of consistent, gridded sectoral downscaling models to explore multiple stakeholder-engaged scenarios. Across scenarios, Argentina has the economic opportunity to use its vast land resources to satisfy growing domestic and international demand for crops, such as oil (e.g., soy) and biomass. The human (rather than earth) system produces the most dominant changes in mid-century EWL resource use. A Reference scenario characterized by modest socioeconomic growth projects a 40% increase in Argentina’s agricultural production by 2050 (relative to 2020) by using 50,000 km2 of additional cropland and 40% more water. A Climate Policy scenario designed to achieve net-zero carbon emissions globally shortly after mid-century projects that Argentina could use 100,000 km2 of additional land (and 65% more water) to grow biomass and other crops. The burden of navigating these national opportunities and challenges could fall disproportionately on a subset of Argentina’s river basins. The Colorado and Negro basins could experience moderate-to-severe water scarcity as they simultaneously navigate substantial irrigated crop demand growth and climate-induced declines in natural water availability. Argentina serves as a generalizable testbed to demonstrate that multi-scale EWL planning challenges can be identified and managed more effectively via integrated analysis of coupled human-earth systems.

[Back to Contents](#contents)

<br />

<!-------------------------->
<!-------------------------->
## Plain Language Summary
<!-------------------------->
<!-------------------------->

This study seeks to understand how Argentina’s energy, water, and land (EWL) systems will co-evolve under a representative array of human and earth system influences, including socioeconomic change, climate change, and climate policy. To capture Argentina’s sub-national EWL dynamics in the context of global change, we couple the Global Change Analysis Model with a suite of consistent, gridded sectoral downscaling models to explore multiple stakeholder-engaged scenarios. Across scenarios, Argentina has the economic opportunity to use its vast land resources to satisfy growing domestic and international demand for crops, such as oil (e.g., soy) and biomass. The human (rather than earth) system produces the most dominant changes in mid-century EWL resource use. A Reference scenario characterized by modest socioeconomic growth projects a 40% increase in Argentina’s agricultural production by 2050 (relative to 2020) by using 50,000 km2 of additional cropland and 40% more water. A Climate Policy scenario designed to achieve net-zero carbon emissions globally shortly after mid-century projects that Argentina could use 100,000 km2 of additional land (and 65% more water) to grow biomass and other crops. The burden of navigating these national opportunities and challenges could fall disproportionately on a subset of Argentina’s river basins. The Colorado and Negro basins could experience moderate-to-severe water scarcity as they simultaneously navigate substantial irrigated crop demand growth and climate-induced declines in natural water availability. Argentina serves as a generalizable testbed to demonstrate that multi-scale EWL planning challenges can be identified and managed more effectively via integrated analysis of coupled human-earth systems.

[Back to Contents](#contents)

<br />

<!-------------------------->
<!-------------------------->
## Code Reference
<!-------------------------->
<!-------------------------->

[1] **Metis:** Khan, Z., Wild, T., Vernon, C., Miller, A., Hejazi, M., Clarke, L., Miralles-Wilhelm, F., Castillo, R.M., Moreda, F., Bereslawski, J.L., Suriano, M. and Casado, J., (2020). Metis v1.1.0. Github. [![GitHub tag](https://img.shields.io/github/v/release/JGCRI/metis)](https://github.com/JGCRI/metis/releases/tag/v1.0.0)

[2] **GCAM:** Khan, Zarrar. (2019, November 5). gcam-v5.1.3LAC_khan_et_al_2020_Uruguay (Version 5.3.1LAC). Zenodo. [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.3897519.svg)](https://doi.org/10.5281/zenodo.3897519)

[3] **Xanthos:** Braun Caleb, Vernon Chris, Link Robert, Evanoff Jason, & Khan Zarrar. (2020, December 30). xanthos-v2.3.1 for Wild_et_al_2020_ArgentinaNexus (Version v2.3.1-wild2020-ArgentinaNexus). Zenodo. [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.4404834.svg)](https://doi.org/10.5281/zenodo.4404834)

[4] **Demeter:** Vernon Chris, & Braun Caleb. (2020, December 30). demeter-v1.1.0 for Wild_et_al_2020_ArgentinaNexus (Version v1.1.0-wild2020-ArgentinaNexus). Zenodo. [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.4404738.svg)](https://doi.org/10.5281/zenodo.4404738)

[5] **Tethys:** Vernon Chris, Link Robert, & Braun Caleb. (2020, December 31). tethys-v1.2.0 for Wild_et_al_2020_ArgentinaNexus (Version v1.2.0-wild2020-ArgentinaNexus). Zenodo. [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.4405008.svg)](https://doi.org/10.5281/zenodo.4405008)

[6] **plutus:** Zhao, M., Binsted, M., Wild, T.B., Khan, Z., Yarlagadda, B., Iyer, G., Vernon, C., Patel, P., Santos da Silva, S.R., Calvin, K.V., (2021, May 18). JGCRI/plutus: plutus v1.0.0 (Version v1.0.0). Zenodo. [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.4771311.svg)](https://doi.org/10.5281/zenodo.4771311)


[Back to Contents](#contents)

<br />

<!-------------------------->
<!-------------------------->
## Journal Reference
<!-------------------------->
<!-------------------------->
Wild, T.B., Khan, Z., Zhao, M., Suriano, M., Bereslawski, J., Roberts, P., Cassado, J., Gavino-Novillo, M., Clarke, L., Hejazi, M., Miralles-Wilhelm, F., Munoz-Castillo, R., Vernon, C., Snyder, A., Yarlagadda, B., Birnbaum, A., Lamontagne, J., White, D., Ojeda-Matos, G. (in revision). The Implications of Global Change for the Co-Evolution of Argentina’s Integrated Energy-Water-Land Systems. Earth’s Future.

[Back to Contents](#contents)

<br />

<!-------------------------->
<!-------------------------->
## Contributing Models
<!-------------------------->
<!-------------------------->

This section provides details regarding the models we ran as part of this study. Some aspects of this study required that we use the outputs of modeling runs performed by others, such as GCM runs and crop model runs. Details regarding this other modeling are provided in the Input Data section. Please note that the models used in this research are the versions labeled in [Table 1](#table1). 

<a name="table1"></a>
**Table 1:** Model repository and DOI links.

| Model | Version | Repository Link | DOI |
|:-:|:-:|---|---|
| Xanthos | <v2.3.1> | <https://github.com/mengqi-z/xanthos/tree/v2.3.1-wild2020-ArgentinaNexus> | <https://doi.org/10.5281/zenodo.4404834> |
| GCAM | <v5.1.3LAC> | <https://doi.org/10.5281/zenodo.3897519> | <https://doi.org/10.5281/zenodo.3897519> |
| Tethys | <v1.2.0> | <https://github.com/mengqi-z/tethys/tree/v1.2.0-wild2020-ArgentinaNexus> | <http://doi.org/10.5281/zenodo.4405008> |
| Demeter | <v1.1.0> | <https://github.com/mengqi-z/demeter/tree/v1.1.0-wild2020-ArgentinaNexus> | <https://doi.org/10.5281/zenodo.4404738> |

[Back to Contents](#contents)

<br />

<!-------------------------->
<!-------------------------->
## Data Reference
<!-------------------------->
<!-------------------------->

### 1. Input Data

#### Forcing Data
In the study of Argentina Energy-Water-Land systems, we selected one climate impact scenario from Global Climate Model (GCM) MIROC-ESM-CHEM forced by Representative Concentration Pathway (RCP) 6.0. The source of climate data for Xanthos is obtained from ISIMIP Fast Track Dataset (citation). Input data for GCAM, Demeter, and Tethys are outputs from their feeding models described in [Figure 1](#figure1). Generally, those outputs need to be post-processed to required formats in order to feed into other models as inputs. We provide R scripts in section [Reproduce My Experiment](#reproduce-my-experiment) for reproducing the post-processed input data.

For broader use of these data, we also provide post-processed input dataset directly (See DOI link in [Table 2](#table2)). These data includes all 20 combinations of GCM/RCP scenarios. There are 5 GCMs (i.e., GFDL-ESM2M, HadGEM2-ES, IPSL-CM5A-LR, MIROC-ESM-CHEM, and NorESM1-M) and 4 RCPs (i.e., rcp2.6, rcp4.5, rcp6.0, and rcp8.5).

<a name="table2"></a>
**Table 2:** Input data for each model and DOI links.

| Input Data Category | Model | DOI | Description |
|---|---|---|---|
| Climate | Xanthos | <link to DOI dataset> | [NPY files] 20 GCM/RCP climate projections. |
| Ag Yield | pDSSAT |  | Data and scripts for post-processing pDSSAT outputs into a form useable by GCAM. |
| GCAM Input Data | GCAM | <http://doi.org/10.5281/zenodo.4437750> | Input data to GCAM modified for LAC region. |
| Projected Land Allocation | Demeter | <http://doi.org/10.5281/zenodo.4420156> | [CSV files] created from land use land cover projection from GCAM output. |
| GCAM Database | Tethys | <http://doi.org/10.5281/zenodo.4437750> | [basex files] created from GCAM runs by GCM. Each GCM run includes 8 combinations from 4 rcps and 2 scenarios (i.e., Climate Impacts scenario and Policy scenario) |

**Disclaimer:* pDSSAT modeling was conducted by [Rosenzweig et al.](https://doi.org/10.1073/pnas.1222463110) as part of AgMIP, not as part of this study. We simply post-processed the outputs of pDSSAT (one of several models included in AgMIP) from [Rosenzweig et al.](https://doi.org/10.1073/pnas.1222463110) into a form that could be used by GCAM. [Synder et al.](https://doi.org/10.1371/journal.pone.0237918) describes the approach to doing that post-processing. The DOI provided here for pDSSAT contains the data and scripts required to conduct the post-processing for this paper, similar to what is described in [Synder et al.](https://doi.org/10.1371/journal.pone.0237918).


#### File Modification and Replacement
For the Argentina study, we replaced some of default files in each model with modified files listed in [Table 3](#table3) to better represent dynamics of the LAC region. This includes separating Uruguay as an individual GCAM region and adding socioeconomic data for Colombia, Uruguay, and Argentina in GCAM, etc. More detailed summary of data and files can be found in [File Replacement Details](docs/summary_modified_files.md).

The Demeter observation dataset is a combination of MIRCA2000 data ([Portmann et al., 2010](https://doi.org/10.1029/2008GB003435)) and MODIS data ([Sulla-Menashe and Friedl, 2018](https://icdc.cen.uni-hamburg.de/fileadmin/user_upload/icdc_Dokumente/MODIS/mcd12_user_guide_v6.pdf)). For details of method that regroups MIRCA2000 crop types to GCAM crop types, please refer to [Huang et al., 2019](https://doi.org/10.1016/j.jhydrol.2019.04.046).

<a name="table3"></a>
**Table 3:** Files replaced for model modifications in the Argentina Nexus study.

| File Category | Model | Directory |
|---|---|---|
| Runoff Module | Xanthos | ArgentinaNexus/DataFiles/Xanthos/example/input/runoff |
| Xanthos Configuration and Model Run | Xanthos | ArgentinaNexus/DataFiles/Xanthos/example |
| GCAM Configuration and Batch Files | GCAM | ArgentinaNexus/DataFiles/GCAM |
| IDB | GCAM | ArgentinaNexus/DataFiles/GCAM/input/idb |
| Allocation | Demeter | ArgentinaNexus/DataFiles/Demeter/example/inputs/allocation |
| Constraints | Demeter | ArgentinaNexus/DataFiles/Demeter/example/inputs/constraints |
| Observation | Demeter | ArgentinaNexus/DataFiles/Demeter/example/inputs/observed |
| Reference | Demeter | ArgentinaNexus/DataFiles/Demeter/example/inputs/reference |
| Demeter Configuration | Demeter | ArgentinaNexus/DataFiles/Demeter/example |
| Region Grids | Tethys | ArgentinaNexus/DataFiles/Tethys/example/Input/harmonized_inputs |
| Region Names | Tethys | ArgentinaNexus/DataFiles/Tethys/example/Input/rng33 |
| Livestock Fraction | Tethys | ArgentinaNexus/DataFiles/Tethys/example/Input/rng33 |
| Electricity | Tethys | ArgentinaNexus/DataFiles/Tethys/example/Input/rng33/TD_Elec_paras |


### 2. Output Data
For broader use, we provide output dataset from model runs with all 20 combinations of GCM/RCP scenarios (See [Table 4](#table4)).

<a name="table4"></a>
**Table 4:** DOI links of model outputs for 20 GCM/RCP scenarios.

| Model | DOI |
|-------|-----|
| Xanthos | <http://doi.org/10.5281/zenodo.4422095> |
| pDSSAT |  |
| GCAM | <http://doi.org/10.5281/zenodo.4420154> | 
| Demeter | <http://doi.org/10.5281/zenodo.4420156> | 
| Tethys | <http://doi.org/10.5281/zenodo.4321776> | 

[Back to Contents](#contents)

<br />

<!-------------------------->
<!-------------------------->
## Reproduce My Experiment
<!-------------------------->
<!-------------------------->

### 1. Run Preparation

This experiment is conducted under Windows 64-bit operating system.

#### (A) Argentina Nexus Repository

  * This repository uses the Git Large File Storage (LFS) extension (see https://git-lfs.github.com/ for details). Please run the following command before cloning if you do not already have Git LFS installed:
  
  ```
  git lfs install
  ```

  * Clone ArgentinaNexus reproducible repository into your desired location.

  ```
  git clone https://github.com/FeralFlows/ArgentinaNexus.git
  ```

  * There are several R packages providing functions to process and analyze model outputs, such as 'Metis' and 'rgcam'. These packages are used frequently in the post-processing R scripts provided in the repository.

    * Download and install R https://cran.r-project.org/ and R studio https://www.rstudio.com
    * Install Metis and rgcam. Open R studio:
    
  ```
  install.packages("devtools")
  devtools::install_github("JGCRI/rgcam")
  devtools::install_github("JGCRI/metis")
  ```

#### (B) GCAM LAC

***Pre-Requirements***
  
  * Download GCAM v5.1.3-LAC https://doi.org/10.5281/zenodo.3897519
  * Download GCAM input data 'input.zip' http://doi.org/10.5281/zenodo.4437750
  * Install Java 64 http://openjdk.java.net/
  * Install Windows XML Maker http://symbolclick.com/xmlmarker_1_1_setup.exe
  
***File Replacement***

  * Replace gcam-core_LAC_v02_5Nov2019/exe/configuration_LAC.xml with ArgentinaNexus/DataFiles/GCAM/configuration_LAC.xml in the cloned ArgentinaNexus repository
  * Replace gcam-core_LAC_v02_5Nov2019/exe/batch_LAC.xml with ArgentinaNexus/DataFiles/GCAM/batch_LAC.xml
  * Upzip downloaded GCAM input data 'input.zip' and use it to replace the entire 'input' folder under gcam-core_LAC_v02_5Nov2019/
  * (Optional) XML files within folders 'Ag', 'Hydro', and 'Water' under directory gcam-core_LAC_v02_5Nov2019/input/idb/impacts are reproduceable. Follow steps for Xanthos model run, post-process Xanthos outputs, and post-process pDSSAT outputs in [Reproduce My Experiment](#reproduce-my-experiment) section.
  
**Note:* GCAM v5.1.3-LAC is a modified version from GCAM-Core-v5.1.3 for the study in Latin America and the Caribbean (LAC) Region. A 64-bit Java is required to run GCAM. We recommend the open source version of Java ([OpenJDK](http://openjdk.java.net/)). More details on GCAM installation, setting up, and trouble shooting, please refer to [GCAM Documentation](https://github.com/JGCRI/gcam-core).

#### (C) pDSSAT

We provide codes to post-process pDSSAT outputs and create agriculture yield XML files for GCAM in this section. However, this step is OPTIONAL because we also provide XML files for agriculture yield in the downloadable GCAM input data in [Table 2](#table2). For information on ISIMIP/pDSSAT model, please refer to [Calvin et al., 2020](https://doi.org/10.1142/S2010007820500050); [Synder et al., 2020](https://doi.org/10.1371/journal.pone.0237918); and [Rosenzweig et al., 2016](https://doi.org/10.1073/pnas.1222463110).

<details>
<summary>Click here to see optional steps to reproduce XML files for agriculture yield.</summary>
<br />

  * Download ISIMIP (pDSSAT included) data and post-processing codes http://doi.org/10.5281/zenodo.4437737
  * Unzip downloaded isimip_yield_processing.zip and navigate to isimip_yield_processing/exe.
  * Run all the R scripts following the order from 'step1' to 'step4' labeled in the file name. Remember do not change the current working directory in R in between the steps.
  * You can find the created XML files in isimip_yield_processing/data/scenario_agprodchange_gcam512_uruguay/xml. The 20 files used in Argentina study are named in the format of 'ag_prodchange_[rcp]\_[gcm]\_pdssat.xml', where
  * [rcp] can be replaced by rcp2p6, rcp4p5, rcp6p0, or rcp8p5
  * [gcm] can be replaced by gfdl, hadgem2, ipsl, miroc, or noresm1
  * These XML files are the same with those under gcam-core_LAC_v02_5Nov2019/input/idb/impacts/Ag. If you want to use files reproduced by you, please change their names to the format of 'ag_prodchange_[gcm]_[rcp].xml', where
  * [gcm] can be replaced by GFDL-ESM2M, HadGEM2-ES, IPSL-CM5A-LR, MIROC-ESM-CHEM, or NorESM1-M
  * [rcp] can be replaced by rcp2p6, rcp4p5, rcp6p0, or rcp8p5

</details>

#### (D) Xanthos, Demeter, and Tethys

***Pre-requirements***

  * Download Xanthos directly from https://doi.org/10.5281/zenodo.4404834, or clone Xanthos to your desired location and checkout the correct branch 'v2.3.1-wild2020-ArgentinaNexus'
  ```
  git clone https://github.com/mengqi-z/xanthos.git
  git checkout v2.3.1-wild2020-ArgentinaNexus
  ```
  * Download Demeter directly from https://doi.org/10.5281/zenodo.4404738, or clone Demeter to your desired location and checkout the correct branch 'v1.1.0-wild2020-ArgentinaNexus'
  ```
  git clone https://github.com/mengqi-z/demeter.git
  git checkout v1.1.0-wild2020-ArgentinaNexus
  ```
  * Download Tethys directly http://doi.org/10.5281/zenodo.4405008, or clone Tethys to your desired location and checkout the correct branch 'v1.2.0-wild2020-ArgentinaNexus' 
  ```
  git clone https://github.com/mengqi-z/tethys.git
  git checkout v1.2.0-wild2020-ArgentinaNexus
  ```
  * (Optional) Install PyCharm Professional version https://www.jetbrains.com/pycharm/download/#section=windows
  * Install Python 2.7 and Python 3.8 https://www.python.org/downloads/
  
**Note:* We will refer all the model folders to 'xanthos/', 'demeter/', and 'tethys/' in the following instructions. If you choose to download models directly from provided DOI links instead of cloning, please change each of the downloaded folder name to 'xanthos', 'demeter', and 'tethys'.

***Model Installation and Setup***\
The user is able to install each model as a Python package from terminal or command line. Navigate to each one of the downloaded model folders (xanthos/, demeter/, and tethys/) and run

```
python setup.py install
```


**Note:* More details of setting up Python using PyCharm for Xanthos, Demeter, and Tethys can be found in this [PyCharm setup tutorial](docs/Python_setup_for_xanthos_demeter_tethys.md). You can also go to Github page for each model listed in [Contributing Models](#contributing-models) for more information.

***File Replacement***\
For downloaded models from DOI links provided in [Contributing Models](#contributing-models) section, most of the input dataset in terms of a single GCM/RCP scenario (i.e., MIROC-ESM-CHEM forced by RCP 6.0) selected in the Argentina study is included, except for Xanthos due to large size of the dataset. Follow the steps below to add data into the downloaded xanthos folder.

  * Unzip historical climate data xanthos/example/input/climate/watch+wfdei.zip
  * Download projected climate data for 5 GCMs in [temporary Google Drive link](https://drive.google.com/drive/folders/1gLK1uAHsGRGolKg1Y0896QZzB9AD8OiE?usp=sharing). Move 5 downloaded data folders under the directory xanthos/example/input/climate/. **This is a temporary link from google drive and only people with permission will be able to download. We will replace the temporary link with DataHub DOI once it is created.*

***File Modification***\
Check each file listed in [Table 5](#table5) and modify every directory within those files to the directory that holds your data. For example, in configuration file 'pm_abcd_mrtm_future_impacts.ini' for xanthos model, change the directory of 'RootDir' to 'your-xanthos-location\example'.

<a name="table5"></a>
**Table 5:** Files to be modified for each model.

| Model | Programming Language | Files to be Modified |
|---|:-:|---|
| Xanthos | Python 3.3+ | under xanthos/example: <br /> (1) pm_abcd_mrtm_future_impacts.ini <br /> (2) future_sim_IDBFinalRuns.py <br /> (3) watch_impacts.ini <br /> (4) watch_wfdei_sim.py |
| Demeter | Python 2.7 | under demeter/example: <br /> (1) config_LAC.ini <br /> (2) example_LAC.py |
| Tethys | Python 3+ | under tethys/example: <br /> (1) config.ini |


<br />

### 2. Model Integration

#### (A) Workflow Overview
[Figure 1](#figure1) details the workflow for reproducing all model outputs once the input data have been prepared.
  * First, we run pDSSAT and Xanthos to calculate crop yield, runoff, and hydropower under climate change scenarios. These runoff and hydropower outputs need to be bias corrected. Outputs from both pDSSAT and Xanthos need to be converted to XML format in order to feed into GCAM.
  * Then, we use GCAM to simulate integrated energy, water, land, socioeconomic, and climate interactions at regional/global scale.
  * To inform policy making at subregional scale, the output of GCAM will be post-processed to certain format for Demeter to downscale global land allocation to subregional land allocation.
  * Tethys is used to downscale global water withdrawal from GCAM to subregional water withdrawal and the model can directly use GCAM output without post-processing.

<a name="figure1"></a>

<p align="center"> <img src="extras/paper_figs/FIG1.png", width = '700'></p>

**Figure 1.** The multi-model, multi-scale, multi-sector analysis framework.
<br />

#### (B) Modeling
We use terminal as an example to run python based models. If you prefer running from an IDE (e.g., PyCharm), check [PyCharm setup tutorial](docs/Python_setup_for_xanthos_demeter_tethys.md) for more details.

***Xanthos***\
To run Xanthos:
  * In the terminal, run Xanthos with historical climate data by navigating to xanthos/example, and run
  ```
  python watch_wfdei_sim.py
  ```
  * Run Xanthos with projected climate data by navigating to xanthos/example, and run
  ```
  python future_sim_IDBFinalRuns.py
  ```

To process Xanthos outputs for GCAM:
  * Change all the directories appeared in 'basin_runoff_analysis_plotting.R', 'hydro_analysis_plotting.R', and 'xanthos_postprocessing_fns.R' to paths that holds you data (file locations listed in [Table 6](#table6)).
  * Post-process Xanthos runoff output by running R script 'basin_runoff_analysis_plotting.R' listed in [Table 6](#table6). This will create same XML files within the downloaded GCAM input data folder: input/idb/impacts/Water. You may replace corresponding XML files in gcam-core_LAC_v02_5Nov2019/input/idb/impacts/Water with the ones you reproduced.
  * Post-process Xanthos hydropower output by running R script 'hydro_analysis_plotting.R' listed in [Table 6](#table6). This will create same XML files within the downloaded GCAM input data folder: input/idb/impacts/Hydro. You may replace corresponding XML files in gcam-core_LAC_v02_5Nov2019/input/idb/impacts/Hydro with the ones you reproduced.

**Note:* The post-process step is optional because all reproduced XML files are already included in the downloaded GCAM input data folder.
  
***GCAM LAC***
  * Go to gcam-core_LAC_v02_5Nov2019/exe and open 'run-gcam.bat' in a text editor. Change the Run GCAM line to point to configuration_LAC.xml: ```Objects-Main.exe -C configuration_LAC.xml```.
  * Run GCAM by double clicking 'run-gcam.bat' to run the model.
  * Check GCAM output database located in gcam-core_LAC_v02_5Nov2019/output/FinalRuns/IDBNexus.
  * One quick way to check GCAM output database is to use GCAM ModelInterface. Go to gcam-core_LAC_v02_5Nov2019/ModelInterface, double click 'run-model-interface.bat'. For more instruction on using ModelInterface, please refer to [GCAM Documentation](https://github.com/JGCRI/gcam-core).
  
***Tethys***
  * GCAM output database is the input data for Tethys. Copy and paste 'IDBNexus' folder under gcam-core_LAC_v02_5Nov2019/output/FinalRuns to tethys/example/Input/GCAM.
  * Change the name for parameter 'GCAM-DBfile' in the configuration file (tethys/example/config.ini) to your pasted folder name 'IDBNexus'.
  * Change the name for parameter 'ProjectName' in config.ini to the name you prefer for the folder holding the outputs. For example, 'gcam_5p1_IDBNexus'.
  * In the terminal, run Tethys by navigating to tethys/example, and run
  ```
  python example.py
  ```

**Note:* You may notice that there are three GCAM database folders already existing under tethys/example/Input/GCAM (e.g., IDBNexus_MIROC-ESM-CHEM_rcp6p0_Reference). This is because the GCAM output database from YOUR GCAM run will integrate all three scenarios together including Reference, Impacts, and Policy scenario. However, Tethys will only recognize the very first scenario (i.e., Reference scenario), while ignoring the other two scenarios. By separating three scenarios into three different GCAM databases, you will be able to run tethys with each database of a single scenario and get the water withdrawal output for each scenario. To do that, open config.ini, change the name for parameter 'GCAM-DBfile' to the database folder name you would like to use (e.g., IDBNexus_MIROC-ESM-CHEM_rcp6p0_Reference), and change the name for parameter 'ProjectName' to the name you prefer for the output folder (e.g., gcam_5p1_MIROC-ESM-CHEM_rcp6p0_Reference).

***Demeter***
  * (Optional) Process GCAM output to Demeter required format by running 'gcam_to_demeter_land_allocation_rgcam.R' (see [Table 6](#table6)). Remember to change all the paths in the R script based on your data location. This R script creates the projected land class allocation files under Reference, Impacts, and Policy scenarios that are already existed in demeter/example/inputs/projected.
  * In the terminal, run Demeter by navigating to demeter/example, and run
  ```
  python example_LAC.py
  ```
  * The cell resolution for Demeter output is 5 arcmin (0.0833 degree). Aggregate output from 5 arcmin to 0.5 degree by running R script 'aggregate_5arcmin_to_0p5degree.py' (see [Table 6](#table6)). Remember to change all the directories in this python file according to your data location and the 'run' names associated with your demeter output folder names. Then, run the python script in the terminal by navigating to ArgentinaNexus/Figures/DemeterProcessing and run
  ```
  python aggregate_5arcmin_to_0p5degree.py
  ```

<a name="table6"></a>
**Table 6:** R scripts for post-processing model outputs.

| Script | Description | Directory |
|--------|-------------|-----------|
| basin_runoff_analysis_plotting.R | Convert Xanthos runoff outputs to XML files for GCAM | ArgentinaNexus/Figures/XanthosProcessing/ |
| hydro_analysis_plotting.R | Convert Xanthos hydropower outputs to XML files for GCAM | ArgentinaNexus/Figures/XanthosProcessing/ |
| xanthos_postprocessing_fns.R | All functions used in basin_runoff_analysis_plotting.R and hydro_analysis_plotting.R | ArgentinaNexus/Figures/XanthosProcessing/ |
| gcam_to_demeter_land_allocation_rgcam.R | Select projected landuse from GCAM output database and convert to required input format for Demeter. Put created files under /Demeter/example/inputs/projected/ | ArgentinaNexus/Figures/DemeterProcessing/ |
| aggregate_5arcmin_to_0p5degree.py | Aggregate Demeter output from 5 arcmin to 0.5 degree for further spatial landuse map plotting with metis | ArgentinaNexus/Figures/DemeterProcessing/ |
|step1_grid_to_basin_wtHA_yieldloop_arealoop.R<br>step2_ISIMIP_to_region_basin_irr_multipliers.R<br>step3_L205.ag_prodchange_cost_input_AdaptedForIntegrationBranch_othermodels.R<br>step3_L205.ag_prodchange_cost_input_AdaptedForIntegrationBrach.R<br>step4_csv2xml.R | Post-processing outputs from pDSSAT to create agricultural yield XML files | isimip_yield_processing/exe/ |

<br />

### 3. Reproduce Figures
We also provide scripts (ArgentinaNexus/Figures/) for reproducing figures in our paper (see [Table 7](#table7)). Before running each script, make sure you have changed all the directories according to your data and file locations. You can change your desired output locations in the scripts.

<a name="table7"></a>
**Table 7:** R scripts for producing figures from the paper.

| Script | Corresponding Figures |
|--------|-----------------------|
| argentina_basin_plot.R | Figure 2 |
| basin_runoff_analysis_plotting.R <br /> hydro_analysis_plotting.R| Figure 3 |
| spatial_runoff_diff_mapping_xanthos.R | Figure 4 |
| EmissionGoalLine_Plot.R | Figure S4 |
| metis.masterX_Argentina.R | Figure 5 - 6 |
| metis_plot_argentina.R | Figure 7 - 10 |


[Back to Top](#argentinanexus)
